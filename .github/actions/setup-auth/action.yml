name: 'Setup and Authentication'
author: '@MassimilianoDH'
description: 'Setup Terraform and Authenticate to Cloud'
inputs:
  ssh-private-key:
    description: 'SSH Key to access private Terraform module Git repositories'
    required: false
  gcp-credentials-json:
    description: 'JSON Key generated by Google Cloud Service Account'
    required: false
runs:
  using: 'composite'
  steps:
    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2

    - name: Verify Terraform Version
      shell: bash
      run: terraform --version

    # Needed for private Git repositories.
    # https://github.com/webfactory/ssh-agent
    - name: Setup SSH for Terraform Modules
      uses: webfactory/ssh-agent@v0.5.4
      with:
        ssh-private-key: ${{ inputs.ssh-private-key }}
  
    # Needed for private storage buckets.
    # More info:
    # AWS Credentials: https://github.com/aws-actions/configure-aws-credentials
    # GCP Auth: https://github.com/google-github-actions/auth
    # Azure Login: https://github.com/Azure/login
    - name: GCP Auth
      uses: google-github-actions/auth@v0
      with:
        credentials_json: ${{ inputs.gcp-credentials-json }}

    - name: Set up Cloud SDK with CI Credentials
      uses: google-github-actions/setup-gcloud@v0